FROM BASE_IMAGE
MAINTAINER alban.linard@lsv.ens-cachan.fr

# Install dhcp client and iproute
RUN apt-get install -y --force-yes udhcpc iproute2 wget gcc

# Install custom kernel:
RUN wget https://www.kernel.org/pub/linux/kernel/v3.x/linux-3.15.7.tar.xz -O /usr/src/
RUN tar xf /usr/src/linux-3.15.7.tar.xz -C /usr/src/
ADD ./data/kernel/kernel-3.15.5-x86_64.config /usr/src/linux-3.15.7/.config
RUN cd /usr/src/linux-3.15.7/ && make -j2
RUN cp /usr/src/linux-3.15.7/arch/x86/boot/bzImage /boot/vmlinuz-3.15.7
RUN ln -s /boot/vmlinuz-3.15.7 /vmlinuz

# Install Bootloader:
RUN apt-get install -y extlinux syslinux-common
RUN mkdir /boot/extlinux
ADD ./data/boot/extlinux /boot/extlinux

# Give a password to root
RUN echo "toor" > /root/pass
RUN echo "toor" >> /root/pass
RUN passwd < /root/pass
RUN rm /root/pass

